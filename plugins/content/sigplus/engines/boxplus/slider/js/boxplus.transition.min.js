/*
 boxplus image transition engine
 @author  Levente Hunyadi
 @version 1.3.4
 @remarks Copyright (C) 2009-2010 Levente Hunyadi
 @remarks Licensed under GNU/GPLv3, see http://www.gnu.org/licenses/gpl-3.0.html
 @see     http://hunyadi.info.hu/projects/boxplus
*/
if(typeof __jQuery__=="undefined")var __jQuery__=jQuery;
(function(b){function F(a,p){var h=parseInt(a.css(p));return isNaN(h)?a[p]():h}var x="boxplus-disabled",z=Math.max,G=Math.floor,A=Math.ceil;b.fn.maxWidth=function(){var a=0;this.each(function(p,h){a=z(a,b(h).safeWidth())});return a};b.fn.maxHeight=function(){var a=0;this.each(function(p,h){a=z(a,b(h).safeHeight())});return a};b.fn.safeWidth=function(){return F(this,"width")};b.fn.safeHeight=function(){return F(this,"height")};b.fn.boxplusTransition=function(a){a=b.extend({navigation:"horizontal",
loop:true,contextmenu:true,orientation:"vertical",slices:15,effect:"fade",easing:"swing",duration:500,delay:4E3},a);this.filter("ul, ol").each(function(){function p(){return B("prev")}function h(){return B("next")}function C(f,k,y){var q=i.eq(e);f.css({backgroundImage:'url("'+q.attr("src")+'")',backgroundPosition:(n-q.safeWidth())/2-k+"px "+((o-q.safeHeight())/2-y)+"px"})}function D(f){var k=f.attr("longdesc");k&&f.attr("src",k).attr("longdesc","")}function B(f){function k(){l.css("opacity",0).show();
return{opacity:1}}function y(){l.css(g?"width":"height",0);return g?{width:n}:{height:o}}function q(){l.css(g?"height":"width",0);return g?{height:A(m)}:{width:A(m)}}var l=b(".boxplus-transition-bars",d);if(E){C(d,0,0);l.clearQueue().stop().css("visibility","hidden")}E=true;switch(f){case "first":e=0;break;case "prev":e=(e-1)%r;break;case "next":e=(e+1)%r;break;case "last":e=r-1;break;default:return}H();D(i.eq(e));D(i.eq((e-1)%r));D(i.eq((e+1)%r));l.css({opacity:1}).each(function(c){var s=b(this);
c=A(c*m+m)-G(c*m);s.css({height:g?c:o,width:g?n:c});c=s.position();C(s,c.left,c.top)});var t;switch(a.effect){case "fade":t=k();break;case "bars":t=y();break;case "bars+fade":t=b.extend(y(),k());break;case "shutter":t=q();break;case "shutter+fade":t=b.extend(q(),k())}l.css("visibility","visible");var I=function(c){return c};switch(f){case "first":case "prev":I=function(c){return u-1-c}}l.each(function(c){c=I(c);var s={duration:500,easing:a.easing};c==u-1&&b.extend(s,{complete:function(){E=false;C(d,
0,0);l.css("visibility","hidden")}});b(this).delay(c*J/u).animate(t,s)});return false}function H(){if(!a.loop){b(".boxplus-prev",d).toggleClass(x,e<=0);b(".boxplus-next",d).toggleClass(x,e>=r-1)}}var v=a.navigation=="vertical",g=a.orientation=="horizontal",u=a.slices,J=a.duration,w=a.delay,e=0,E=false,j=b(this).wrap("<div />").before("<div />").addClass("boxplus-hidden"),L=j.parent().addClass("boxplus-wrapper"),i=b("li",j).css({position:"absolute",left:0,top:0}).find("img:first");i.parent("a").click(function(f){if(!f.isDefaultPrevented())location.href=
this.href});var d=j.prev().addClass("boxplus-transition").addClass(x).click(function(){i.eq(e).parent("a").click()}),r=i.length,n=i.maxWidth(),o=i.maxHeight();L.add(d).css({width:n,height:o});switch(a.navigation){case "horizontal":case "vertical":j="boxplus-"+a.navigation;d.addClass(j);d.prepend(b('<div class="boxplus-prev" /><div class="boxplus-next" />').addClass(j).addClass((v?n:o)<120?"boxplus-small":"boxplus-large"));b(".boxplus-prev",d).click(p);b(".boxplus-next",d).click(h)}a.contextmenu||
b(document).bind("contextmenu",function(f){return!d.children().add(d).filter(f.target).size()});var m=(g?o:n)/u;for(v=0;v<u;v++){j=G(v*m);b('<div class="boxplus-transition-bars" />').css({left:g?0:j,top:g?j:0,height:g?m:o,width:g?n:m,visibility:"hidden"}).appendTo(d)}H();d.removeClass(x);B("first");if(w>0){w=z(w,J+500);var K=window.setInterval(h,w);d.mouseover(function(){window.clearInterval(K)}).mouseout(function(){K=window.setInterval(h,w)})}});return this}})(__jQuery__);
